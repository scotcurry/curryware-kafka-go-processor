package postgreshandlers

import (
	"curryware-kafka-go-processor/internal/jsonhandlers"
	"encoding/base64"
	"testing"
)

func TestInsertStatInfo(t *testing.T) {

	testString := "[{\"LeagueStatKey\":461134074,\"StatId\":4,\"StatEnabled\":true,\"StatName\":\"Passing Yards\",\"StatDisplayName\":\"Pass Yds\",\"StatGroup\":\"passing\",\"StatAbbreviation\":\"Yds\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":461134075,\"StatId\":5,\"StatEnabled\":true,\"StatName\":\"Passing Touchdowns\",\"StatDisplayName\":\"Pass TD\",\"StatGroup\":\"passing\",\"StatAbbreviation\":\"TD\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":461134076,\"StatId\":6,\"StatEnabled\":true,\"StatName\":\"Interceptions\",\"StatDisplayName\":\"Int\",\"StatGroup\":\"passing\",\"StatAbbreviation\":\"Int\",\"StatSortOrder\":0,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":461134078,\"StatId\":8,\"StatEnabled\":true,\"StatName\":\"Rushing Attempts\",\"StatDisplayName\":\"Rush Att\",\"StatGroup\":\"rushing\",\"StatAbbreviation\":\"Att\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":461134079,\"StatId\":9,\"StatEnabled\":true,\"StatName\":\"Rushing Yards\",\"StatDisplayName\":\"Rush Yds\",\"StatGroup\":\"rushing\",\"StatAbbreviation\":\"Yds\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340710,\"StatId\":10,\"StatEnabled\":true,\"StatName\":\"Rushing Touchdowns\",\"StatDisplayName\":\"Rush TD\",\"StatGroup\":\"rushing\",\"StatAbbreviation\":\"TD\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340711,\"StatId\":11,\"StatEnabled\":true,\"StatName\":\"Receptions\",\"StatDisplayName\":\"Rec\",\"StatGroup\":\"receiving\",\"StatAbbreviation\":\"Rec\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340712,\"StatId\":12,\"StatEnabled\":true,\"StatName\":\"Receiving Yards\",\"StatDisplayName\":\"Rec Yds\",\"StatGroup\":\"receiving\",\"StatAbbreviation\":\"Yds\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340713,\"StatId\":13,\"StatEnabled\":true,\"StatName\":\"Receiving Touchdowns\",\"StatDisplayName\":\"Rec TD\",\"StatGroup\":\"receiving\",\"StatAbbreviation\":\"TD\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340715,\"StatId\":15,\"StatEnabled\":true,\"StatName\":\"Return Touchdowns\",\"StatDisplayName\":\"Ret TD\",\"StatGroup\":\"return\",\"StatAbbreviation\":\"TD\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340716,\"StatId\":16,\"StatEnabled\":true,\"StatName\":\"2-Point Conversions\",\"StatDisplayName\":\"2-PT\",\"StatGroup\":\"misc\",\"StatAbbreviation\":\"2-PT\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340718,\"StatId\":18,\"StatEnabled\":true,\"StatName\":\"Fumbles Lost\",\"StatDisplayName\":\"Fum Lost\",\"StatGroup\":\"fumbles\",\"StatAbbreviation\":\"Lost\",\"StatSortOrder\":0,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340778,\"StatId\":78,\"StatEnabled\":true,\"StatName\":\"Targets\",\"StatDisplayName\":\"Targets\",\"StatGroup\":\"receiving\",\"StatAbbreviation\":\"Targets\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340757,\"StatId\":57,\"StatEnabled\":true,\"StatName\":\"Offensive Fumble Return TD\",\"StatDisplayName\":\"Fum Ret TD\",\"StatGroup\":\"misc\",\"StatAbbreviation\":\"Off Fumb TD\",\"StatSortOrder\":1,\"StatPositionType\":\"O\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340719,\"StatId\":19,\"StatEnabled\":true,\"StatName\":\"Field Goals 0-19 Yards\",\"StatDisplayName\":\"FG 0-19\",\"StatGroup\":\"fgs\",\"StatAbbreviation\":\"0-19 Yds\",\"StatSortOrder\":1,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340720,\"StatId\":20,\"StatEnabled\":true,\"StatName\":\"Field Goals 20-29 Yards\",\"StatDisplayName\":\"FG 20-29\",\"StatGroup\":\"fgs\",\"StatAbbreviation\":\"20-29 Yds\",\"StatSortOrder\":1,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340721,\"StatId\":21,\"StatEnabled\":true,\"StatName\":\"Field Goals 30-39 Yards\",\"StatDisplayName\":\"FG 30-39\",\"StatGroup\":\"fgs\",\"StatAbbreviation\":\"30-39 Yds\",\"StatSortOrder\":1,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340722,\"StatId\":22,\"StatEnabled\":true,\"StatName\":\"Field Goals 40-49 Yards\",\"StatDisplayName\":\"FG 40-49\",\"StatGroup\":\"fgs\",\"StatAbbreviation\":\"40-49 Yds\",\"StatSortOrder\":1,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340723,\"StatId\":23,\"StatEnabled\":true,\"StatName\":\"Field Goals 50+ Yards\",\"StatDisplayName\":\"FG 50+\",\"StatGroup\":\"fgs\",\"StatAbbreviation\":\"50+ Yds\",\"StatSortOrder\":1,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340724,\"StatId\":24,\"StatEnabled\":true,\"StatName\":\"Field Goals Missed 0-19 Yards\",\"StatDisplayName\":\"FGM 0-19\",\"StatGroup\":\"fgm\",\"StatAbbreviation\":\"0-19 Yds\",\"StatSortOrder\":0,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340725,\"StatId\":25,\"StatEnabled\":true,\"StatName\":\"Field Goals Missed 20-29 Yards\",\"StatDisplayName\":\"FGM 20-29\",\"StatGroup\":\"fgm\",\"StatAbbreviation\":\"20-29 Yds\",\"StatSortOrder\":0,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340729,\"StatId\":29,\"StatEnabled\":true,\"StatName\":\"Point After Attempt Made\",\"StatDisplayName\":\"PAT Made\",\"StatGroup\":\"pat\",\"StatAbbreviation\":\"Made\",\"StatSortOrder\":1,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340730,\"StatId\":30,\"StatEnabled\":true,\"StatName\":\"Point After Attempt Missed\",\"StatDisplayName\":\"PAT Miss\",\"StatGroup\":\"pat\",\"StatAbbreviation\":\"Miss\",\"StatSortOrder\":0,\"StatPositionType\":\"K\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340731,\"StatId\":31,\"StatEnabled\":true,\"StatName\":\"Points Allowed\",\"StatDisplayName\":\"Pts Allow\",\"StatGroup\":\"none\",\"StatAbbreviation\":\"Pts vs.\",\"StatSortOrder\":0,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340732,\"StatId\":32,\"StatEnabled\":true,\"StatName\":\"Sack\",\"StatDisplayName\":\"Sack\",\"StatGroup\":\"team_tackles\",\"StatAbbreviation\":\"Sack\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340733,\"StatId\":33,\"StatEnabled\":true,\"StatName\":\"Interception\",\"StatDisplayName\":\"Int\",\"StatGroup\":\"def_turnovers\",\"StatAbbreviation\":\"Int\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340734,\"StatId\":34,\"StatEnabled\":true,\"StatName\":\"Fumble Recovery\",\"StatDisplayName\":\"Fum Rec\",\"StatGroup\":\"def_turnovers\",\"StatAbbreviation\":\"Fum Rec\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340735,\"StatId\":35,\"StatEnabled\":true,\"StatName\":\"Touchdown\",\"StatDisplayName\":\"TD\",\"StatGroup\":\"tds\",\"StatAbbreviation\":\"TD\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340736,\"StatId\":36,\"StatEnabled\":true,\"StatName\":\"Safety\",\"StatDisplayName\":\"Safe\",\"StatGroup\":\"team_tackles\",\"StatAbbreviation\":\"Safe\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340737,\"StatId\":37,\"StatEnabled\":true,\"StatName\":\"Block Kick\",\"StatDisplayName\":\"Blk Kick\",\"StatGroup\":\"misc\",\"StatAbbreviation\":\"Blk Kick\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340750,\"StatId\":50,\"StatEnabled\":true,\"StatName\":\"Points Allowed 0 points\",\"StatDisplayName\":\"Pts Allow 0\",\"StatGroup\":\"pts_allow\",\"StatAbbreviation\":\"0 Pts\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340751,\"StatId\":51,\"StatEnabled\":true,\"StatName\":\"Points Allowed 1-6 points\",\"StatDisplayName\":\"Pts Allow 1-6\",\"StatGroup\":\"pts_allow\",\"StatAbbreviation\":\"1-6 Pts\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340752,\"StatId\":52,\"StatEnabled\":true,\"StatName\":\"Points Allowed 7-13 points\",\"StatDisplayName\":\"Pts Allow 7-13\",\"StatGroup\":\"pts_allow\",\"StatAbbreviation\":\"7-13 Pts\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340753,\"StatId\":53,\"StatEnabled\":true,\"StatName\":\"Points Allowed 14-20 points\",\"StatDisplayName\":\"Pts Allow 14-20\",\"StatGroup\":\"pts_allow\",\"StatAbbreviation\":\"14-20 Pts\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340754,\"StatId\":54,\"StatEnabled\":true,\"StatName\":\"Points Allowed 21-27 points\",\"StatDisplayName\":\"Pts Allow 21-27\",\"StatGroup\":\"pts_allow\",\"StatAbbreviation\":\"21-27 Pts\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340755,\"StatId\":55,\"StatEnabled\":true,\"StatName\":\"Points Allowed 28-34 points\",\"StatDisplayName\":\"Pts Allow 28-34\",\"StatGroup\":\"pts_allow\",\"StatAbbreviation\":\"28-34 Pts\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340756,\"StatId\":56,\"StatEnabled\":true,\"StatName\":\"Points Allowed 35+ points\",\"StatDisplayName\":\"Pts Allow 35+\",\"StatGroup\":\"pts_allow\",\"StatAbbreviation\":\"35+ Pts\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0},{\"LeagueStatKey\":4611340782,\"StatId\":82,\"StatEnabled\":true,\"StatName\":\"Extra Point Returned\",\"StatDisplayName\":\"XPR\",\"StatGroup\":\"misc\",\"StatAbbreviation\":\"XPR\",\"StatSortOrder\":1,\"StatPositionType\":\"DT\",\"StatSortPostion\":0}]"
	testStringBase64 := base64.StdEncoding.EncodeToString([]byte(testString))
	statInfoDictionary, err := jsonhandlers.ParseLeagueStatInfo(testStringBase64)
	if err != nil {
		t.Errorf("Error parsing stat info: %v", err)
	}
	insertedRecords := InsertLeagueStatInfo(statInfoDictionary)
	expectedRecords := 38

	if insertedRecords != expectedRecords {
		t.Errorf("Expected %d records to be inserted, but %d were inserted", expectedRecords, insertedRecords)
	}
}

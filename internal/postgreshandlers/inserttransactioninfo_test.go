package postgreshandlers

import (
	"curryware-kafka-go-processor/internal/jsonhandlers"
	"encoding/base64"
	"testing"
)

func TestInsertTransactionRecords(t *testing.T) {

	// transactionInfo := `{"TransactionCount":56,"Transactions":[{"TransactionKey":"461.l.460188.tr.61","TransactionId":61,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1758958222,"PlayersInvolved":[{"PlayerKey":"461.p.100002","PlayerId":100002,"TransactionKey":"461.l.460188.tr.61","TransactionType":"add","TransactionSource":"waivers","DestinationType":"team","DestinationTeamId":"461.l.460188.t.9"},{"PlayerKey":"461.p.100028","PlayerId":100028,"TransactionKey":"461.l.460188.tr.61","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.460188.tr.60","TransactionId":60,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1758813598,"PlayersInvolved":[{"PlayerKey":"461.p.100017","PlayerId":100017,"TransactionKey":"461.l.460188.tr.60","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.460188.t.3"},{"PlayerKey":"461.p.100026","PlayerId":100026,"TransactionKey":"461.l.460188.tr.60","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.460188.tr.59","TransactionId":59,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1758813564,"PlayersInvolved":[{"PlayerKey":"461.p.29269","PlayerId":29269,"TransactionKey":"461.l.460188.tr.59","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.460188.t.3"},{"PlayerKey":"461.p.33443","PlayerId":33443,"TransactionKey":"461.l.460188.tr.59","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.460188.tr.58","TransactionId":58,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1758811390,"PlayersInvolved":[{"PlayerKey":"461.p.29236","PlayerId":29236,"TransactionKey":"461.l.460188.tr.58","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.460188.t.4"}]},{"TransactionKey":"461.l.460188.tr.57","TransactionId":57,"TransactionType":"drop","TransactionStatus":"successful","TransactionTimestamp":1758811280,"PlayersInvolved":[{"PlayerKey":"461.p.25785","PlayerId":25785,"TransactionKey":"461.l.460188.tr.57","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.460188.tr.56","TransactionId":56,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1758798125,"PlayersInvolved":[{"PlayerKey":"461.p.100023","PlayerId":100023,"TransactionKey":"461.l.460188.tr.56","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.460188.t.2"}]}]}`
	// transactionInfo := `{"LeagueKey":"461.l.394957","TransactionCount":89,"Transactions":[{"TransactionKey":"461.l.394957.tr.96","TransactionId":96,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1760081241,"PlayersInvolved":[{"PlayerKey":"461.p.26658","PlayerId":26658,"TransactionKey":"461.l.394957.tr.96","TransactionType":"add","TransactionSource":"waivers","DestinationType":"team","DestinationTeamId":"461.l.394957.t.8"}]},{"TransactionKey":"461.l.394957.tr.95","TransactionId":95,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1760071662,"PlayersInvolved":[{"PlayerKey":"461.p.100028","PlayerId":100028,"TransactionKey":"461.l.394957.tr.95","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.2"},{"PlayerKey":"461.p.100016","PlayerId":100016,"TransactionKey":"461.l.394957.tr.95","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.394957.tr.94","TransactionId":94,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1760071003,"PlayersInvolved":[{"PlayerKey":"461.p.41052","PlayerId":41052,"TransactionKey":"461.l.394957.tr.94","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.1"}]},{"TransactionKey":"461.l.394957.tr.93","TransactionId":93,"TransactionType":"drop","TransactionStatus":"successful","TransactionTimestamp":1760059452,"PlayersInvolved":[{"PlayerKey":"461.p.30136","PlayerId":30136,"TransactionKey":"461.l.394957.tr.93","TransactionType":"drop","TransactionSource":"team","DestinationType":"freeagents","DestinationTeamId":""}]},{"TransactionKey":"461.l.394957.tr.92","TransactionId":92,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1760059363,"PlayersInvolved":[{"PlayerKey":"461.p.30136","PlayerId":30136,"TransactionKey":"461.l.394957.tr.92","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.8"},{"PlayerKey":"461.p.40078","PlayerId":40078,"TransactionKey":"461.l.394957.tr.92","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]}]}`
	transactionInfo := `{"LeagueKey":"461.l.394957","TransactionCount":92,"Transactions":[{"TransactionKey":"461.l.394957.tr.99","TransactionId":99,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1760154108,"PlayersInvolved":[{"PlayerKey":"461.p.41877","PlayerId":41877,"TransactionKey":"461.l.394957.tr.99","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.11"}]},{"TransactionKey":"461.l.394957.tr.98","TransactionId":98,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1760146367,"PlayersInvolved":[{"PlayerKey":"461.p.28188","PlayerId":28188,"TransactionKey":"461.l.394957.tr.98","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.1"}]},{"TransactionKey":"461.l.394957.tr.97","TransactionId":97,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1760106146,"PlayersInvolved":[{"PlayerKey":"461.p.100011","PlayerId":100011,"TransactionKey":"461.l.394957.tr.97","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.6"},{"PlayerKey":"461.p.100034","PlayerId":100034,"TransactionKey":"461.l.394957.tr.97","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.394957.tr.96","TransactionId":96,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1760081241,"PlayersInvolved":[{"PlayerKey":"461.p.26658","PlayerId":26658,"TransactionKey":"461.l.394957.tr.96","TransactionType":"add","TransactionSource":"waivers","DestinationType":"team","DestinationTeamId":"461.l.394957.t.8"}]},{"TransactionKey":"461.l.394957.tr.95","TransactionId":95,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1760071662,"PlayersInvolved":[{"PlayerKey":"461.p.100028","PlayerId":100028,"TransactionKey":"461.l.394957.tr.95","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.2"},{"PlayerKey":"461.p.100016","PlayerId":100016,"TransactionKey":"461.l.394957.tr.95","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.394957.tr.94","TransactionId":94,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1760071003,"PlayersInvolved":[{"PlayerKey":"461.p.41052","PlayerId":41052,"TransactionKey":"461.l.394957.tr.94","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.1"}]},{"TransactionKey":"461.l.394957.tr.93","TransactionId":93,"TransactionType":"drop","TransactionStatus":"successful","TransactionTimestamp":1760059452,"PlayersInvolved":[{"PlayerKey":"461.p.30136","PlayerId":30136,"TransactionKey":"461.l.394957.tr.93","TransactionType":"drop","TransactionSource":"team","DestinationType":"freeagents","DestinationTeamId":""}]}]}`
	transactionInfo64 := base64.StdEncoding.EncodeToString([]byte(transactionInfo))
	transactionArray := jsonhandlers.ParseTransactionInfo(transactionInfo64)
	rows := ProcessTransactionInfo(transactionArray)
	println(rows)
}

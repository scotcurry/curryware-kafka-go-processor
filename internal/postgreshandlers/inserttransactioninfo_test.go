package postgreshandlers

import (
	"curryware-kafka-go-processor/internal/jsonhandlers"
	"encoding/base64"
	"testing"
)

func TestInsertTransactionRecords(t *testing.T) {

	// transactionInfo := `{"TransactionCount":56,"Transactions":[{"TransactionKey":"461.l.460188.tr.61","TransactionId":61,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1758958222,"PlayersInvolved":[{"PlayerKey":"461.p.100002","PlayerId":100002,"TransactionKey":"461.l.460188.tr.61","TransactionType":"add","TransactionSource":"waivers","DestinationType":"team","DestinationTeamId":"461.l.460188.t.9"},{"PlayerKey":"461.p.100028","PlayerId":100028,"TransactionKey":"461.l.460188.tr.61","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.460188.tr.60","TransactionId":60,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1758813598,"PlayersInvolved":[{"PlayerKey":"461.p.100017","PlayerId":100017,"TransactionKey":"461.l.460188.tr.60","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.460188.t.3"},{"PlayerKey":"461.p.100026","PlayerId":100026,"TransactionKey":"461.l.460188.tr.60","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.460188.tr.59","TransactionId":59,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1758813564,"PlayersInvolved":[{"PlayerKey":"461.p.29269","PlayerId":29269,"TransactionKey":"461.l.460188.tr.59","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.460188.t.3"},{"PlayerKey":"461.p.33443","PlayerId":33443,"TransactionKey":"461.l.460188.tr.59","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.460188.tr.58","TransactionId":58,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1758811390,"PlayersInvolved":[{"PlayerKey":"461.p.29236","PlayerId":29236,"TransactionKey":"461.l.460188.tr.58","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.460188.t.4"}]},{"TransactionKey":"461.l.460188.tr.57","TransactionId":57,"TransactionType":"drop","TransactionStatus":"successful","TransactionTimestamp":1758811280,"PlayersInvolved":[{"PlayerKey":"461.p.25785","PlayerId":25785,"TransactionKey":"461.l.460188.tr.57","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.460188.tr.56","TransactionId":56,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1758798125,"PlayersInvolved":[{"PlayerKey":"461.p.100023","PlayerId":100023,"TransactionKey":"461.l.460188.tr.56","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.460188.t.2"}]}]}`
	// transactionInfo := `{"LeagueKey":"461.l.394957","TransactionCount":89,"Transactions":[{"TransactionKey":"461.l.394957.tr.96","TransactionId":96,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1760081241,"PlayersInvolved":[{"PlayerKey":"461.p.26658","PlayerId":26658,"TransactionKey":"461.l.394957.tr.96","TransactionType":"add","TransactionSource":"waivers","DestinationType":"team","DestinationTeamId":"461.l.394957.t.8"}]},{"TransactionKey":"461.l.394957.tr.95","TransactionId":95,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1760071662,"PlayersInvolved":[{"PlayerKey":"461.p.100028","PlayerId":100028,"TransactionKey":"461.l.394957.tr.95","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.2"},{"PlayerKey":"461.p.100016","PlayerId":100016,"TransactionKey":"461.l.394957.tr.95","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]},{"TransactionKey":"461.l.394957.tr.94","TransactionId":94,"TransactionType":"add","TransactionStatus":"successful","TransactionTimestamp":1760071003,"PlayersInvolved":[{"PlayerKey":"461.p.41052","PlayerId":41052,"TransactionKey":"461.l.394957.tr.94","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.1"}]},{"TransactionKey":"461.l.394957.tr.93","TransactionId":93,"TransactionType":"drop","TransactionStatus":"successful","TransactionTimestamp":1760059452,"PlayersInvolved":[{"PlayerKey":"461.p.30136","PlayerId":30136,"TransactionKey":"461.l.394957.tr.93","TransactionType":"drop","TransactionSource":"team","DestinationType":"freeagents","DestinationTeamId":""}]},{"TransactionKey":"461.l.394957.tr.92","TransactionId":92,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1760059363,"PlayersInvolved":[{"PlayerKey":"461.p.30136","PlayerId":30136,"TransactionKey":"461.l.394957.tr.92","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.8"},{"PlayerKey":"461.p.40078","PlayerId":40078,"TransactionKey":"461.l.394957.tr.92","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":""}]}]}`
	transactionInfo := `{"LeagueKey":"461.l.394957","TransactionCount":229,"Transactions":[{"TransactionKey":"461.l.394957.tr.246","TransactionId":246,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1766070006,"GameId":461,"LeagueId":394957,"PlayersInvolved":[{"PlayerKey":"461.p.100018","PlayerId":100018,"TransactionKey":"461.l.394957.tr.246","TransactionType":"add","TransactionSource":"freeagents","DestinationType":"team","DestinationTeamId":"461.l.394957.t.5","SourceTeamId":"461.l.394957.t.5"},{"PlayerKey":"461.p.100027","PlayerId":100027,"TransactionKey":"461.l.394957.tr.246","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":"461.l.394957.t.5","SourceTeamId":"461.l.394957.t.5"}]},{"TransactionKey":"461.l.394957.tr.245","TransactionId":245,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1765964451,"GameId":461,"LeagueId":394957,"PlayersInvolved":[{"PlayerKey":"461.p.32803","PlayerId":32803,"TransactionKey":"461.l.394957.tr.245","TransactionType":"add","TransactionSource":"waivers","DestinationType":"team","DestinationTeamId":"461.l.394957.t.10","SourceTeamId":"461.l.394957.t.10"},{"PlayerKey":"461.p.41003","PlayerId":41003,"TransactionKey":"461.l.394957.tr.245","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":"461.l.394957.t.10","SourceTeamId":"461.l.394957.t.10"}]},{"TransactionKey":"461.l.394957.tr.244","TransactionId":244,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1765964451,"GameId":461,"LeagueId":394957,"PlayersInvolved":[{"PlayerKey":"461.p.40063","PlayerId":40063,"TransactionKey":"461.l.394957.tr.244","TransactionType":"add","TransactionSource":"waivers","DestinationType":"team","DestinationTeamId":"461.l.394957.t.10","SourceTeamId":"461.l.394957.t.10"},{"PlayerKey":"461.p.40231","PlayerId":40231,"TransactionKey":"461.l.394957.tr.244","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":"461.l.394957.t.10","SourceTeamId":"461.l.394957.t.10"}]},{"TransactionKey":"461.l.394957.tr.243","TransactionId":243,"TransactionType":"add/drop","TransactionStatus":"successful","TransactionTimestamp":1765964451,"GameId":461,"LeagueId":394957,"PlayersInvolved":[{"PlayerKey":"461.p.100002","PlayerId":100002,"TransactionKey":"461.l.394957.tr.243","TransactionType":"add","TransactionSource":"waivers","DestinationType":"team","DestinationTeamId":"461.l.394957.t.10","SourceTeamId":"461.l.394957.t.10"},{"PlayerKey":"461.p.100029","PlayerId":100029,"TransactionKey":"461.l.394957.tr.243","TransactionType":"drop","TransactionSource":"team","DestinationType":"waivers","DestinationTeamId":"461.l.394957.t.10","SourceTeamId":"461.l.394957.t.10"}]}]}`
	transactionInfo64 := base64.StdEncoding.EncodeToString([]byte(transactionInfo))
	transactionArray := jsonhandlers.ParseTransactionInfo(transactionInfo64)
	rows := ProcessTransactionInfo(transactionArray)
	println(rows)
}
